@page "/parents"
@using BlazorApp.Models
@using BlazorApp.Services
@using System.Text.Json
@using Newtonsoft.Json
@inject ParentService ParentService;
<h1>Parent List</h1>


<div class="bg-white rounded mt-6 border border-bottom-0">

	<div class="d-flex justify-content-end gap-1 p-1 mt-4">
		<a class="btn btn-primary" href="/parents/create">Add Parent</a>
		<button class="btn btn-primary">Save List</button>
	</div>

	<div class="d-flex justify-content-between mt-2 border p-1">
		<h6>Parent/Guardian List</h6>
		<div>
			<div class="input-group">
				<input type="search" name="search" placeholder="search" /><span class="bi bi-search input-group-text"></span>

			</div>

		</div>
	</div>

	<table class="table table-striped table-hover border p-1">
		<thead>
			<tr>
				<th class="text-primary">First Name</th>
				<th class="text-primary">Last Name</th>
				<th class="text-primary">Username</th>
				<th class="text-primary">Home Address</th>
				<th class="text-primary">Phone1</th>
				<th class="text-primary">Work Phone</th>
				<th class="text-primary">Home Phone</th>
				<th class="text-primary">Children Count</th>
				<th>Actions</th>

			</tr>
		</thead>
		<tbody>
			@if(parents.Count > 0)
			{
				@foreach (var parent in parents)
				{
					<tr>
						<td>@parent.FirstName</td>
						<td>@parent.LastName</td>
						<td>@parent.Username</td>
						<td>@parent.HomeAddress</td>
						<td>@parent.Phone1</td>
						<td>@parent.WorkPhone</td>
						<td>@parent.HomePhone</td>
						<td>@parent.children</td>
						<td><a class="bi bi-layout-text-sidebar-reverse text-primary" href="/parents/details/@parent.Id"></a> <a class="bi bi-pencil text-primary" href="/parents/edit/@parent.Id"></a> <a class="bi bi-trash text-primary" href="/parents/delete/@parent.Id"></a></td>
						@* <td>@student.FirstName</td> *@

					</tr>
				}
				
			}
		</tbody>
		<div class="d-flex gap-3 m-1">
			<button class=" bi bi-caret-left-fill border-0" @onclick="HandlePrevious" disabled="@PreviousBool"></button>
			<button class=" bi bi-caret-right-fill border-0" @onclick="HandleNext" disabled="@NextBool"></button>
		</div>
	</table>
</div>

@code {

	private List<ParentModel> parents = new List<ParentModel>();
	private decimal page = 1;
	private decimal pageSize = 2;
	private decimal total;
	private bool NextBool;
	private bool PreviousBool;

	protected override async Task OnInitializedAsync()
	{
		await GetParents();
	}

	private async void HandleNext()
	{
		if (page < total)
		{
			page += 1;
			await GetParents();
			StateHasChanged();

		}
	}

	private async void HandlePrevious()
	{
		if (page > 1)
		{
			page -= 1;
			await GetParents();
			StateHasChanged();

		}
	}

	private async Task GetParents()
	{
		var response = await ParentService.GetAllparents((int)page, (int)pageSize);
		parents = JsonConvert.DeserializeObject<List<ParentModel>>(response.data.ToString());
		page = response.page;
		pageSize = (decimal)response.pageSize;
		Console.WriteLine($"Total: {response.total} pageSize: {pageSize}");
		total = Math.Ceiling(response.total / pageSize);
		Console.WriteLine($"Total: {total}");
		if (page >= total)
		{
			NextBool = true;
		}
		else
		{
			NextBool = false;
		}

		if (page != 1)
		{
			PreviousBool = false;
		}
		else
		{
			PreviousBool = true;
		}
	}

}
